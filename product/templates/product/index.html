{% extends "layout.html" %}
{% load static %}
{% block content %}
<div class="page-title light-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Category</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="{% url "home" %}">Home</a></li>
            <li class="current">Category</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <div class="container">
      <div class="row">

        <div class="col-lg-4 sidebar">

          <div class="widgets-container">

            <!-- Product Categories Widget -->
            <div class="product-categories-widget widget-item">

              <h3 class="widget-title">Categories</h3>

              <ul class="category-tree list-unstyled mb-0">
                <!-- Clothing Category -->
                {% for category in categories %} 
                <li class="category-item">
                      <div class="d-flex justify-content-between align-items-center category-header collapsed" data-bs-toggle="collapse" data-bs-target="#categories-1-clothing-subcategories-{{ forloop.counter }}" aria-expanded="false" aria-controls="categories-1-clothing-subcategories-{{ forloop.counter }}">
                          <a href="{% url "product:product_cate" category.slug %}" class="category-link">{{ category.name }}</a>
                          <span class="category-toggle">
                              <i class="bi bi-chevron-down"></i>
                              <i class="bi bi-chevron-up"></i>
                            </span>
                      </div>
                      <ul id="categories-1-clothing-subcategories-{{ forloop.counter }}" class="subcategory-list list-unstyled collapse ps-3 mt-2">
                          {% for product in products %}
                              {% if product.category_id == category.id %}
                                  <li><a href="#" class="subcategory-link">{{ product.name }}</a></li>
                              {% endif %}
                          {% endfor %}
                      </ul>
                </li>
                {% endfor %}
                  {% for product in products  %}
                  <ul id="categories-1-clothing-subcategories" class="subcategory-list list-unstyled collapse ps-3 mt-2">
                      <li><a href="" class="subcategory-link">{{product.name}}</a></li>
                     
                    </ul>
                    {% endfor %}
                </li>

              
                
              </ul>

            </div><!--/Product Categories Widget -->


          </div>

        </div>

        <div class="col-lg-8">

          <!-- Category Header Section -->
          <section id="category-header" class="category-header section">

            <div class="container" data-aos="fade-up">

              

                

            </div>

          </section><!-- /Category Header Section -->

          <!-- Category Product List Section -->
          <section id="category-product-list" class="category-product-list section">

            <div class="container" data-aos="fade-up" data-aos-delay="100">

              <div class="row g-4">
                <!-- Product List -->
                {% for product in products %}
                <div class="col-6 col-xl-4">
                    <div class="product-card" data-aos="zoom-in">
                        <div class="product-image">
                            <img src="{{product.productimage.url}}" class="main-image img-fluid" alt="Product">
                            <img src="{{product.productimage.url}}" class="hover-image img-fluid" alt="Product Variant">
                            <div class="product-overlay">
                                <div class="product-actions">
                                    <button type="button" class="action-btn" data-bs-toggle="tooltip" title="Quick View">
                                        <a href="{% url "product:product_detail" product.id %}"><i class="bi bi-eye"></i></a>
                                    </button>
                                    <form action="{% url "cart:add_cart" %}" method="POST"  class=" cart-forms">
                                        {% comment %} {% if user.is_authenticated %} {% endcomment %}
                                        {% csrf_token %}
                                        <input type="text"hidden name="product-id" value="{{product.id}}" name="product-id">
                                        <button  class="action-btn" data-bs-toggle="tooltip" title="Add to Cart">
                                            <i class="bi bi-cart-plus"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="product-details">
                            <div class="product-category">{{product.category}}</div>
                            <h4 class="product-title"><a href="product-details.html">{{product.name}}</a></h4>
                            <div class="product-meta">
                                <div class="product-price">${{product.price}}</div>
                                <div class="product-rating">
                                    <i class="bi bi-star-fill"></i>
                                    {{product.rating}} <span>({{product.review_count}})</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <!-- Product 2 -->
                <div class="col-6 col-xl-4">
                  <div class="product-card" data-aos="zoom-in" data-aos-delay="100">
                    <div class="product-image">
                      <img src="assets/img/product/product-m-1.webp" class="main-image img-fluid" alt="Product">
                      <img src="assets/img/product/product-m-2.webp" class="hover-image img-fluid" alt="Product Variant">
                      <div class="product-overlay">
                        <div class="product-actions">
                          <button type="button" class="action-btn" data-bs-toggle="tooltip" title="Quick View">
                            <i class="bi bi-eye"></i>
                          </button>
                          <button type="button" class="action-btn" data-bs-toggle="tooltip" title="Add to Cart">
                            <i class="bi bi-cart-plus"></i>
                          </button>
                        </div>
                      </div>
                      <div class="product-badge new">New</div>
                    </div>
                    <div class="product-details">
                      <div class="product-category">Men's Collection</div>
                      <h4 class="product-title"><a href="product-details.html">Elit Consectetur</a></h4>
                      <div class="product-meta">
                        <div class="product-price">$95.00</div>
                        <div class="product-rating">
                          <i class="bi bi-star-fill"></i>
                          4.6 <span>(28)</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Product 3 -->
                <div class="col-6 col-xl-4">
                  <div class="product-card" data-aos="zoom-in" data-aos-delay="200">
                    <div class="product-image">
                      <img src="assets/img/product/product-f-3.webp" class="main-image img-fluid" alt="Product">
                      <img src="assets/img/product/product-f-4.webp" class="hover-image img-fluid" alt="Product Variant">
                      <div class="product-overlay">
                        <div class="product-actions">
                          <button type="button" class="action-btn" data-bs-toggle="tooltip" title="Quick View">
                            <i class="bi bi-eye"></i>
                          </button>
                          <button type="button" class="action-btn" data-bs-toggle="tooltip" title="Add to Cart">
                            <i class="bi bi-cart-plus"></i>
                          </button>
                        </div>
                      </div>
                      <div class="product-badge sale">-25%</div>
                    </div>
                    <div class="product-details">
                      <div class="product-category">Accessories</div>
                      <h4 class="product-title"><a href="product-details.html">Adipiscing Magna</a></h4>
                      <div class="product-meta">
                        <div class="product-price">
                          $75.00
                          <span class="original-price">$99.00</span>
                        </div>
                        <div class="product-rating">
                          <i class="bi bi-star-fill"></i>
                          4.9 <span>(56)</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

               
              </div>

            </div>

          </section><!-- /Category Product List Section -->

          

        </div>

      </div>
    </div>















    



    <script>

     const forms = document.querySelectorAll('.cart-forms');
    forms.forEach(form => { 
        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission
            const url = this.action; // Get the action URL of the form
            const formData = new FormData(this); // Collect form data
            fetch(url, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': form.querySelector('input[name="csrfmiddlewaretoken"]').value // Use CSRF token from form
                },
                body: formData // Send form data as FormData
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                // Optionally update the UI or show a success message
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });
    });
 </script>
 
 {% endblock content %} 
 
